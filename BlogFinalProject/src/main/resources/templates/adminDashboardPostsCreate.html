<!DOCTYPE html>
<html lang = "en" xmlns = "http://www.w3.org/1999/xhtml"
      xmlns:th = "http://www.thymeleaf.org"
      xmlns:sec = "http://www.thymeleaf.org/extras/spring-security">
<head>
    <meta http-equiv = "content-type" content = "text/html; charset=UTF-8">
    <meta charset = "utf-8">
    <meta name = "viewport" content = "width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>ADMIN - Sadukie's School of Thought</title>
    <!-- Bootstrap core CSS -->
    <link rel = "stylesheet" href = "https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
          integrity = "sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T"
          crossorigin = "anonymous">
    <!--Google Font For Title-->
    <link href = "https://fonts.googleapis.com/css2?family=Laila:wght@300;400;500;600;700&display=swap"
          rel = "stylesheet">
    <!--TINY MCE SCRIPT - NEEDS TO BE IN HEADER-->
    <script src = "https://cdn.tiny.cloud/1/t2t1lagzzqlegqh3wicxgg3mvd174faoh7guw3em7109mch1/tinymce/5/tinymce.min.js"
            referrerpolicy = "origin"></script>

    <!-- Custom styles for this template -->
    <link href = "../static/css/blogStyles.css" th:href = "@{/css/blogStyles.css}" rel = "stylesheet">


    <style th:inline = "text">
        .card {
            border: 1px solid rgba(0, 0, 0, 0.125);
        }

        /*.currentPageLinkUsers {*/
        /*    border-bottom: 2px solid black;*/
        /*    padding-bottom: 3px;*/
        /*}*/

        .currentPageLinkPosts {
            border-bottom: 2px solid black;
            padding-bottom: 3px;
        }

        /*.currentPageLinkHashtags {*/
        /*    border-bottom: 2px solid black;*/
        /*    padding-bottom: 3px;*/
        /*}*/

        /*.currentPageLinkCommentApproval {*/
        /*    border-bottom: 2px solid black;*/
        /*    padding-bottom: 3px;*/
        /*}*/

        /*.currentPageLinkPostApproval {*/
        /*    border-bottom: 2px solid black;*/
        /*    padding-bottom: 3px;*/
        /*}*/
    </style>

</head>

<body sec:authorize = "hasRole('ADMIN')">
    <div th:replace = "fragments/adminFragments :: blogNavAdmin"></div>
    <div th:replace = "fragments/adminFragments :: adminNavBar"></div>

    <div class = "container-fluid">
        <div class = "row">
            <div th:replace = "fragments/adminFragments :: adminSidebar"></div>
            <main role = "main" class = "col-md-9 ml-sm-auto col-lg-10 px-4">
                <div class = "content">

                    <h2 class = "mt-4">Create New Post</h2>
                    <hr>
                    <div class = "col-12 m-1 text-center"
                         th:if = "${!errors.isEmpty()}">
                        <p class = "alert alert-danger" th:each = "error : ${errors}"
                           th:text = "${error.message}">Error message</p>
                    </div>
                    <form th:action = "@{/admin/postCreate}" class = "col-12" method = "post">

                        <div class = "form-group row">
                            <label for = "title" class = "col-2 col-form-label text-right font-weight-bold">
                                Post Title</label>
                            <input type = "text" id = "title" name = "title" class = "col-9 form-control">
                        </div>

                        <div class = "form-group row">
                            <label for = "postAt" class = "col-2 col-form-label text-right font-weight-bold">
                                Publish At</label>
                            <input type = "datetime-local" id = "postAt" name = "postAt"
                                   class = "col-4 form-control">
                            <label for = "expireAt" class = "col-1 col-form-label text-right font-weight-bold">
                                Expire At</label>
                            <input type = "datetime-local" id = "expireAt" name = "expireAt"
                                   class = "col-4 form-control">
                        </div>

                        <div class = "form-group row">
                            <label for = "hashtagsForPost" class = "col-2 col-form-label text-right font-weight-bold">
                                Hashtags For Post</label>
                            <input type = "text" id = "hashtagsForPost" name = "hashtagsForPost"
                                   class = "form-control col-8">
                            <button type = "button"
                                    class = "btn btn-sm btn-outline-dark rounded-circle mx-4 font-weight-bold"
                                    data-container = "body" data-toggle = "popover" data-placement = "top"
                                    data-content = "Type new hashtags separated by commas. Click a hashtag below to add it to the list."
                            >&nbsp;&nbsp;i&nbsp;&nbsp;
                            </button>
                        </div>

                        <div class = "form-group row">
                            <span for = "hashtagsForPost" class = "col-2 text-right font-weight-bold">
                                Existing Hashtags</span>
                            <div class = "col-9">
                                <span th:each = "hashtag : ${hashtags}">
                                    <span th:text = "${hashtag.title}" th:id = "${hashtag.title}"
                                          onclick = "addTagToInput(this.id)"></span>
                                        <span>&nbsp;</span> <!--SPACE-->
                                </span>
                            </div>
                        </div>

                        <div class = "form-group row">
                            <label for = "staticPage" class = "col-2 col-form-label text-right font-weight-bold">
                                Static Page</label>
                            <input type = "checkbox" id = "staticPage" name = "staticPage" class = "col-1 form-control">

                            <label for = "file" class = "offset-1 col-2 col-form-label font-weight-bold text-right">
                                Title Photo</label>
                            <div class = "custom-file text-left col-5">
                                <input type = "file" class = "custom-file-input" name = "file" id = "file"
                                       onchange = "$('#nameOfFile').html(this.files[0].name)">
                                <label class = "custom-file-label" id = "nameOfFile" for = "file">Choose file...</label>
                            </div>
                        </div>


                        <textarea name = "content" id = "content" style = "height: 800px;"></textarea>


                        <input type = "hidden" th:value = "${#authentication.principal.userId}" name = "userId"
                               id = "userId">

                        <input type = "hidden"
                               th:name = "${_csrf.parameterName}"
                               th:value = "${_csrf.token}"/>

                        <div class = "form-group row justify-content-around my-4">
                            <button class = "btn btn-outline-danger" type = "submit" name = "action"
                                    value = "cancel">
                                Cancel
                            </button>
                            <button class = "btn btn-outline-dark" type = "submit" name = "action" value = "save">
                                Save Post
                            </button>
                        </div>

                    </form>


                </div>
            </main>
        </div>
    </div>

    <!-- Bootstrap core JavaScript =============== -->
    <script src = "https://code.jquery.com/jquery-3.5.1.min.js"
            integrity = "sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin = "anonymous"></script>
    <script src = "https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"
            integrity = "sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1"
            crossorigin = "anonymous"></script>
    <script src = "https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"
            integrity = "sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM"
            crossorigin = "anonymous"></script>
    <script src = "https://use.fontawesome.com/70752389cd.js"></script>

    <script>
        $(function () {
            $('[data-toggle="popover"]').popover()
        })

        function addTagToInput(theTag) {
            var hashtagInputOnPage = document.getElementById("hashtagsForPost");
            var hashtagString = hashtagInputOnPage.value;
            hashtagString += theTag + ", ";
            hashtagInputOnPage.value = hashtagString;
        }


        tinymce.init({
            selector: '#content',
            plugins: 'print preview paste importcss searchreplace autolink autosave save directionality code visualblocks visualchars fullscreen image link media template codesample table charmap hr pagebreak nonbreaking anchor toc insertdatetime advlist lists wordcount imagetools textpattern noneditable help charmap quickbars emoticons',
            menubar: 'file edit view insert format tools table help',
            toolbar: 'undo redo | bold italic underline strikethrough | fontselect fontsizeselect formatselect | alignleft aligncenter alignright alignjustify | outdent indent |  numlist bullist | forecolor backcolor removeformat | pagebreak | charmap emoticons | fullscreen  preview save print | insertfile image media template link anchor codesample | ltr rtl',
            toolbar_sticky: true,
            image_advtab: true,
            /* enable title field in the Image dialog*/
            image_title: true,
            /* enable automatic uploads of images represented by blob or data URIs*/
            automatic_uploads: true,
            /*
              URL of our upload handler (for more details check: https://www.tiny.cloud/docs/configure/file-image-upload/#images_upload_url)
              images_upload_url: 'postAcceptor.php',
              here we add custom filepicker only to Image dialog
            */
            file_picker_types: 'image',
            /* and here's our custom image picker*/
            file_picker_callback: function (cb, value, meta) {
                var input = document.createElement('input');
                input.setAttribute('type', 'file');
                input.setAttribute('accept', 'image/*');
                /*
                  Note: In modern browsers input[type="file"] is functional without
                  even adding it to the DOM, but that might not be the case in some older
                  or quirky browsers like IE, so you might want to add it to the DOM
                  just in case, and visually hide it. And do not forget do remove it
                  once you do not need it anymore.
                */
                input.onchange = function () {
                    var file = this.files[0];
                    var reader = new FileReader();
                    reader.onload = function () {
                        /*
                          Note: Now we need to register the blob in TinyMCEs image blob
                          registry. In the next release this part hopefully won't be
                          necessary, as we are looking to handle it internally.
                        */
                        var id = 'blobid' + (new Date()).getTime();
                        var blobCache = tinymce.activeEditor.editorUpload.blobCache;
                        var base64 = reader.result.split(',')[1];
                        var blobInfo = blobCache.create(id, file, base64);
                        blobCache.add(blobInfo);
                        /* call the callback and populate the Title field with the file name */
                        cb(blobInfo.blobUri(), {title: file.name});
                    };
                    reader.readAsDataURL(file);
                };
                input.click();
            },
            content_style: 'body { font-family:Helvetica,Arial,sans-serif; font-size:14px }'
        });

    </script>
</body>

</html>